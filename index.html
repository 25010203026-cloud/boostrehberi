<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BoostRehberi - Oyun Performans & Mod Merkezi</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap');

        body, a, button, input, textarea, select {
            cursor: url('https://cdn.custom-cursor.com/db/cursor/32/minecraft_diamond_pickaxe_cursor.png'), auto !important;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(rgba(15, 20, 25, 0.85), rgba(15, 20, 25, 0.95)), url('arkaplan.jpg') center/cover fixed;
            color: #E0E0E0; margin: 0; padding: 0; overflow-x: hidden;
        }

        /* HEADER */
        header { 
            background-color: rgba(17, 21, 29, 0.95); padding: 20px 50px; 
            display: flex; justify-content: space-between; align-items: center; 
            border-bottom: 2px solid #1ABC9C; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px);
        }
        .logo { font-size: 28px; font-weight: 900; color: #FFFFFF; text-decoration: none; letter-spacing: 1px;}
        .logo span { color: #1ABC9C; }
        
        .header-right { display: flex; align-items: center; gap: 20px; }
        .login-btn { background: transparent; border: 2px solid #1ABC9C; color: #1ABC9C; padding: 10px 20px; border-radius: 8px; font-weight: 700; font-size: 14px; transition: 0.3s; }
        .login-btn:hover { background: #1ABC9C; color: #111; box-shadow: 0 0 15px rgba(26, 188, 156, 0.5); }
        
        .user-profile { display: none; align-items: center; gap: 10px; color: #2ECC71; font-weight: 700; }
        .logout-btn { background: transparent; border: 1px solid #E74C3C; color: #E74C3C; padding: 5px 10px; border-radius: 4px; font-size: 12px; transition: 0.3s;}
        .logout-btn:hover { background: #E74C3C; color: #FFF; }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px 50px 20px; }

        /* VÄ°TRÄ°N BÃ–LÃœMÃœ */
        #showcaseSection { display: block; animation: fadeIn 0.4s; }
        .hero { text-align: center; padding: 80px 20px 50px 20px; }
        .hero h1 { font-size: 50px; color: #FFF; margin-bottom: 15px; font-weight: 900; text-transform: uppercase;}
        .hero h1 span { color: #1ABC9C; }
        .hero p { font-size: 18px; color: #AAB7B8; max-width: 700px; margin: 0 auto; line-height: 1.6; }

        .forum-banner { background: linear-gradient(135deg, rgba(26, 188, 156, 0.1), rgba(109, 40, 217, 0.1)); border: 1px solid rgba(26, 188, 156, 0.3); border-radius: 12px; padding: 30px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 50px; }
        .forum-text h2 { margin: 0 0 10px 0; color: #FFF; font-size: 24px; display: flex; align-items: center; gap: 10px;}
        .forum-text p { margin: 0; color: #AAB7B8; font-size: 15px; }
        .forum-btn { background: linear-gradient(90deg, #1ABC9C, #3498DB); border: none; color: #FFF; padding: 15px 30px; border-radius: 8px; font-size: 16px; font-weight: 800; transition: 0.3s; box-shadow: 0 5px 15px rgba(26, 188, 156, 0.3); }
        .forum-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(26, 188, 156, 0.5); }

        .section-title { font-size: 28px; color: #FFF; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 30px; }
        .games-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; }
        
        .game-card { background-color: rgba(20, 25, 30, 0.8); border: 1px solid #333; border-radius: 12px; padding: 30px; transition: 0.3s; display: flex; flex-direction: column; position: relative; overflow: hidden; }
        .game-card::before { content: ""; position: absolute; top: 0; left: 0; width: 4px; height: 100%; }
        .game-card.mc::before { background-color: #2ECC71; }
        .game-card.fm::before { background-color: #6D28D9; }
        .game-card.ac::before { background-color: #E74C3C; }
        .game-card.gta::before { background-color: #2ECC71; }

        .game-card:hover { transform: translateY(-10px); background-color: rgba(30, 35, 45, 0.9); }
        .game-card.mc:hover { border-color: #2ECC71; box-shadow: 0 10px 20px rgba(46, 204, 113, 0.2); }
        .game-card.fm:hover { border-color: #6D28D9; box-shadow: 0 10px 20px rgba(109, 40, 217, 0.2); }
        .game-card.ac:hover { border-color: #E74C3C; box-shadow: 0 10px 20px rgba(231, 76, 60, 0.2); }
        .game-card.gta:hover { border-color: #2ECC71; box-shadow: 0 10px 20px rgba(46, 204, 113, 0.2); }
        
        .game-icon { font-size: 40px; margin-bottom: 15px; }
        .game-card h3 { color: #FFF; font-size: 22px; margin: 0 0 10px 0; }
        .game-card p { color: #8892B0; font-size: 14px; margin: 0 0 25px 0; flex-grow: 1; }
        
        .play-btn { background-color: #1A1A1A; color: #FFF; text-align: center; text-decoration: none; padding: 12px; border-radius: 6px; font-weight: 700; border: 1px solid #444; transition: 0.3s; }
        .game-card.mc .play-btn:hover { background-color: #2ECC71; color: #000; border-color: #2ECC71;}
        .game-card.fm .play-btn:hover { background-color: #6D28D9; color: #FFF; border-color: #6D28D9;}
        .game-card.ac .play-btn:hover { background-color: #E74C3C; color: #FFF; border-color: #E74C3C;}
        .game-card.gta .play-btn:hover { background-color: #2ECC71; color: #000; border-color: #2ECC71;}
        
        .free-download-badge { display: inline-block; background: rgba(46, 204, 113, 0.1); color: #2ECC71; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 700; margin-bottom: 10px; border: 1px solid #2ECC71; }

        /* FORUM BÃ–LÃœMÃœ */
        #forumSection { display: none; padding-top: 40px; animation: fadeIn 0.4s; }
        .forum-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px; border-bottom: 1px solid #2C3E50; padding-bottom: 20px;}
        .forum-header h1 { font-size: 32px; color: #FFF; margin: 0; font-weight: 800; display: flex; align-items: center; gap: 10px;}
        .forum-actions { display: flex; gap: 15px; }
        .back-to-games-btn { background: transparent; color: #AAB7B8; border: 1px solid #555; padding: 12px 20px; border-radius: 6px; font-weight: 700; transition: 0.3s; }
        .back-to-games-btn:hover { background: #333; color: #FFF; }
        .new-topic-btn { background: #1ABC9C; color: #000; border: none; padding: 12px 25px; border-radius: 6px; font-weight: 800; font-size: 15px; transition: 0.3s; box-shadow: 0 4px 10px rgba(26, 188, 156, 0.3);}
        .new-topic-btn:hover { background: #16A085; transform: translateY(-2px);}

        .forum-grid { display: grid; grid-template-columns: 260px 1fr; gap: 30px; align-items: start; }
        .forum-sidebar { background-color: rgba(20, 25, 30, 0.8); padding: 20px; border-radius: 12px; border: 1px solid #2C3E50; position: sticky; top: 90px; }
        .forum-sidebar-title { color: #8892B0; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; font-weight: 700; }
        .cat-btn { background: transparent; color: #AAB7B8; border: none; width: 100%; text-align: left; padding: 12px 15px; border-radius: 8px; font-size: 14px; font-weight: 600; transition: 0.2s; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center;}
        .cat-btn:hover { background: rgba(255,255,255,0.05); color: #FFF; }
        .cat-btn.active { background: rgba(26, 188, 156, 0.1); color: #1ABC9C; border-left: 3px solid #1ABC9C; }

        .thread-list { display: flex; flex-direction: column; gap: 15px; }
        .thread-card { background: rgba(22, 27, 34, 0.9); border: 1px solid #2C3E50; border-radius: 10px; padding: 20px; display: flex; flex-direction: column; gap: 15px; transition: 0.2s; }
        .thread-card:hover { border-color: #555; background: rgba(30, 35, 45, 0.9); }
        
        .thread-main { display: flex; gap: 20px; align-items: flex-start; }
        .thread-avatar { width: 50px; height: 50px; border-radius: 50%; background: #2C3E50; display: flex; justify-content: center; align-items: center; font-size: 24px; border: 2px solid #1ABC9C; flex-shrink: 0; overflow: hidden;}
        .thread-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .thread-content { flex-grow: 1; }
        .thread-title { margin: 0 0 5px 0; color: #FFF; font-size: 18px; font-weight: 700; }
        .thread-body { color: #AAB7B8; font-size: 14px; line-height: 1.5; margin-bottom: 10px;}
        .thread-meta { font-size: 12px; color: #8892B0; display: flex; gap: 15px; align-items: center; }
        .thread-author { color: #1ABC9C; font-weight: 700; }
        
        .thread-actions { display: flex; gap: 10px; margin-top: 10px;}
        .reply-btn { background: rgba(26, 188, 156, 0.1); color: #1ABC9C; border: 1px solid #1ABC9C; padding: 6px 12px; border-radius: 4px; font-size: 12px; font-weight: 700; transition: 0.2s;}
        .reply-btn:hover { background: #1ABC9C; color: #000; }

        .replies-container { background: rgba(0, 0, 0, 0.3); border-left: 2px solid #3498DB; padding: 15px; border-radius: 8px; margin-top: 10px; display: flex; flex-direction: column; gap: 10px;}
        .reply-item { display: flex; gap: 10px; align-items: flex-start; border-bottom: 1px solid #333; padding-bottom: 10px;}
        .reply-item:last-child { border-bottom: none; padding-bottom: 0;}
        .reply-avatar { width: 30px; height: 30px; border-radius: 50%; border: 1px solid #3498DB; overflow: hidden; flex-shrink: 0;}
        .reply-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .reply-content { flex-grow: 1; font-size: 13px; color: #DDD;}
        .reply-author { color: #3498DB; font-weight: 700; font-size: 12px; margin-bottom: 3px; display: block;}

        .pinned { border-left: 4px solid #F1C40F !important; }

        /* MODAL PENCERELER */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px); z-index: 1000; justify-content: center; align-items: center; }
        .modal-box { background: #11151D; width: 400px; border-radius: 12px; border: 1px solid #1ABC9C; padding: 30px; box-shadow: 0 15px 30px rgba(0,0,0,0.5); position: relative; animation: slideDown 0.3s ease-out; text-align: center;}
        .modal-box.large { width: 600px; text-align: left;}
        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 24px; color: #888; background: none; border: none; font-weight: bold; padding: 0;}
        .close-btn:hover { color: #FFF; }

        .google-btn { background: #FFF; color: #444; font-weight: 800; border: none; padding: 15px; border-radius: 6px; font-size: 16px; margin-top: 20px; transition: 0.3s; width: 100%; display: flex; align-items: center; justify-content: center; gap: 15px; box-shadow: 0 4px 10px rgba(255,255,255,0.1);}
        .google-btn:hover { background: #f1f1f1; transform: scale(1.02); }
        .google-btn img { width: 24px; }

        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { font-size: 12px; color: #AAB7B8; font-weight: 600; margin-bottom: 5px; display: block; }
        .input-group input, .input-group select, .input-group textarea { width: 100%; padding: 12px; background: #1A202C; border: 1px solid #333; border-radius: 6px; color: #FFF; font-family: 'Montserrat'; box-sizing: border-box; outline: none; transition: 0.3s; }
        .input-group input:focus, .input-group select:focus, .input-group textarea:focus { border-color: #1ABC9C; }
        .input-group textarea { height: 120px; resize: none; }
        
        .submit-btn { background: #1ABC9C; color: #000; font-weight: 800; border: none; padding: 15px; border-radius: 6px; font-size: 16px; margin-top: 10px; transition: 0.3s; width: 100%; }
        .submit-btn:hover { background: #16A085; transform: scale(1.02); }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="logo">Boost<span>Rehberi</span></a>
        <div class="header-right">
            <button id="loginBtn" class="login-btn" onclick="openAuthModal()">GiriÅŸ Yap / Ãœye Ol</button>
            <div id="userProfile" class="user-profile">
                <img id="userPhoto" src="" alt="Profil" style="width: 30px; height: 30px; border-radius: 50%; border: 2px solid #2ECC71;">
                <span>HoÅŸ geldin, <span id="usernameDisplay">Patron</span></span>
                <button class="logout-btn" onclick="logoutFirebase()">Ã‡Ä±kÄ±ÅŸ Yap</button>
            </div>
        </div>
    </header>

    <div class="container">
        <div id="showcaseSection">
            <section class="hero">
                <h1>Oyunlarda <span>Maksimum</span> Performans</h1>
                <p>FPS artÄ±rma taktikleri, hayat kurtaran modlar, gÃ¼ncel yamalar ve TÃ¼rkiye'nin en bÃ¼yÃ¼k oyuncu kÃ¼tÃ¼phanesine hoÅŸ geldin.</p>
            </section>

            <div class="forum-banner">
                <div class="forum-text">
                    <h2>ğŸ‘‘ BoostRehberi VIP Forum</h2>
                    <p>TakÄ±m arkadaÅŸÄ± bul, oyun iÃ§i sorunlarÄ±nÄ± paylaÅŸ, kendi rehberlerini oluÅŸtur.</p>
                </div>
                <button class="forum-btn" onclick="goToForum()">Forum'a Gir â”</button>
            </div>

            <h2 class="section-title">Oyun KÃ¼tÃ¼phanesi</h2>
            <div class="games-grid">
                <div class="game-card mc">
                    <div class="free-download-badge">Ä°ndirmeler Ãœcretsiz & AÃ§Ä±k</div>
                    <div class="game-icon">â›ï¸</div>
                    <h3>Minecraft 1.20+</h3>
                    <p>Oyun motorunu deÄŸiÅŸtiren FPS modlarÄ±, sÄ±nÄ±rsÄ±z farmlar, efsanevi seed kodlarÄ±.</p>
                    <a href="minecraft.html" class="play-btn">Rehbere Git</a>
                </div>

                <div class="game-card fm">
                    <div class="free-download-badge">Ä°ndirmeler Ãœcretsiz & AÃ§Ä±k</div>
                    <div class="game-icon">âš½</div>
                    <h3>Football Manager 2026</h3>
                    <p>Orijinal isim yamasÄ±, kasmayan taktikleri ve en ucuz Wonderkidleri.</p>
                    <a href="fm.html" class="play-btn">Taktik TahtasÄ±na GeÃ§</a>
                </div>

                <div class="game-card ac">
                    <div class="free-download-badge">Ä°ndirmeler Ãœcretsiz & AÃ§Ä±k</div>
                    <div class="game-icon">ğŸï¸</div>
                    <h3>Assetto Corsa</h3>
                    <p>Japonya otoyolunda trafik makas modu rehberi.</p>
                    <a href="assetto.html" class="play-btn">Garaja Gir</a>
                </div>

                <div class="game-card gta">
                    <div class="free-download-badge">Ä°ndirmeler Ãœcretsiz & AÃ§Ä±k</div>
                    <div class="game-icon">ğŸ”«</div>
                    <h3>Grand Theft Auto V</h3>
                    <p>Oyunu bozmadan mod kurma ve FiveM Roleplay rehberi.</p>
                    <a href="gta5.html" class="play-btn" style="background:#2ECC71; color:#000; border-color:#2ECC71;">Los Santos'a Ä°n</a>
                </div>
            </div>
        </div>

        <div id="forumSection">
            <div class="forum-header">
                <h1>ğŸ’¬ Topluluk Forumu</h1>
                <div class="forum-actions">
                    <button class="back-to-games-btn" onclick="goToGames()">â¬… Oyunlara DÃ¶n</button>
                    <button class="new-topic-btn" onclick="openTopicModal()">+ Yeni Konu AÃ§</button>
                </div>
            </div>

            <div class="forum-grid">
                <div class="forum-sidebar">
                    <div class="forum-sidebar-title">Kategoriler</div>
                    <button class="cat-btn active">ğŸŒ TÃ¼mÃ¼</button>
                    <button class="cat-btn">ğŸ’¬ Genel TartÄ±ÅŸma</button>
                    <button class="cat-btn">â›ï¸ Minecraft</button>
                    <button class="cat-btn">âš½ Football Manager</button>
                    <button class="cat-btn">ğŸï¸ Assetto Corsa</button>
                    <button class="cat-btn">ğŸ”« GTA 5</button>
                </div>

                <div class="main-panel">
                    <div class="thread-list" id="threadContainer">
                        <div class="thread-card pinned">
                            <div class="thread-main">
                                <div class="thread-avatar" style="border-color: #F1C40F; background: transparent; color: #F1C40F; font-size: 20px;">ğŸ‘‘</div>
                                <div class="thread-content">
                                    <h3 class="thread-title"><span style="background: #F1C40F; color: #000;">SABÄ°T</span> ğŸ“Œ HoÅŸ Geldiniz! Forum KurallarÄ± ve KullanÄ±m Rehberi</h3>
                                    <div class="thread-body">Yeni Ã¼yelerimiz, lÃ¼tfen konu aÃ§madan Ã¶nce oyun kategorilerine dikkat edelim. KÃ¼fÃ¼r ve argo kullanÄ±mÄ± yasaktÄ±r. Ä°yi oyunlar!</div>
                                    <div class="thread-meta">
                                        <span class="thread-author">Admin_Mustafa</span> â€¢ ğŸ“… Kurucu â€¢ ğŸ“ Kategori: Genel TartÄ±ÅŸma
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                </div>
            </div>
        </div>
    </div>

    <div id="authModal" class="modal-overlay">
        <div class="modal-box">
            <button class="close-btn" onclick="closeAuthModal()">Ã—</button>
            <h2 style="color: #FFF; margin-top: 0;">BoostRehberi'ne KatÄ±l</h2>
            <p style="color: #AAB7B8; font-size: 14px;">VIP Foruma girmek ve konularÄ± gÃ¶rmek iÃ§in giriÅŸ yap.</p>
            <button class="google-btn" onclick="loginWithGoogle()">
                <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" alt="Google">
                Google ile GÃ¼venli GiriÅŸ Yap
            </button>
        </div>
    </div>

    <div id="topicModal" class="modal-overlay">
        <div class="modal-box large">
            <button class="close-btn" onclick="closeTopicModal()">Ã—</button>
            <h2 style="color: #FFF; margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 20px;">ğŸ“ Yeni Konu BaÅŸlat</h2>
            <div class="input-group">
                <label>Oyun / Kategori SeÃ§imi</label>
                <select id="topicCat">
                    <option value="ğŸ’¬ Genel TartÄ±ÅŸma">ğŸ’¬ Genel TartÄ±ÅŸma</option>
                    <option value="â›ï¸ Minecraft">â›ï¸ Minecraft</option>
                    <option value="âš½ Football Manager">âš½ Football Manager</option>
                    <option value="ğŸï¸ Assetto Corsa">ğŸï¸ Assetto Corsa</option>
                    <option value="ğŸ”« GTA 5">ğŸ”« GTA 5</option>
                </select>
            </div>
            <div class="input-group">
                <label>Konu BaÅŸlÄ±ÄŸÄ±</label>
                <input type="text" id="topicTitle" placeholder="Ã–rn: Sorunumu nasÄ±l Ã§Ã¶zebilirim?">
            </div>
            <div class="input-group">
                <label>Ä°Ã§erik (MesajÄ±nÄ±z)</label>
                <textarea id="topicBody" placeholder="Buraya yazmaya baÅŸlayÄ±n... (KÃ¼fÃ¼r filtreye takÄ±lÄ±r!)"></textarea>
            </div>
            <button class="submit-btn" onclick="submitTopicToDatabase()">Foruma GÃ¶nder</button>
        </div>
    </div>

    <div id="replyModal" class="modal-overlay">
        <div class="modal-box large">
            <button class="close-btn" onclick="closeReplyModal()">Ã—</button>
            <h2 style="color: #3498DB; margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 20px;">ğŸ’¬ Konuya Cevap Yaz</h2>
            <input type="hidden" id="replyThreadId"> <div class="input-group">
                <label>YanÄ±tÄ±nÄ±z</label>
                <textarea id="replyBody" placeholder="CevabÄ±nÄ±zÄ± buraya yazÄ±n..."></textarea>
            </div>
            <button class="submit-btn" style="background:#3498DB;" onclick="submitReply()">YanÄ±tÄ± GÃ¶nder</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
        // YENÄ°: updateDoc, doc ve arrayUnion eklendi (Cevaplar iÃ§in)
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, query, orderBy, doc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

        // Senin AnahtarlarÄ±n
        const firebaseConfig = {
            apiKey: "AIzaSyC7NhVifwWUaKikHE3QrkKwjhnLdaW48OY",
            authDomain: "boostrehberi.firebaseapp.com",
            projectId: "boostrehberi",
            storageBucket: "boostrehberi.firebasestorage.app",
            messagingSenderId: "775353055674",
            appId: "1:775353055674:web:47d8d22d3a5e976b834583"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        window.isUserLoggedIn = false;
        window.currentUsername = "";
        window.currentUserPhoto = "";
        
        // --- KÃœFÃœR FÄ°LTRESÄ° MOTORU (BOUNCER) ---
        // Buraya istediÄŸin kadar kÃ¼fÃ¼r veya yasaklÄ± kelime ekleyebilirsin patron!
        const yasakliKelimeler = ["salak", "aptal", "gerizekalÄ±", "mal", "kÃ¶tÃ¼kelime", "lan"]; 
        
        window.sansurle = (metin) => {
            let temizMetin = metin;
            yasakliKelimeler.forEach(kelime => {
                // BÃ¼yÃ¼k-kÃ¼Ã§Ã¼k harf duyarsÄ±z arar (gi) ve sansÃ¼rler (***)
                const regex = new RegExp(kelime, "gi");
                temizMetin = temizMetin.replace(regex, "***");
            });
            return temizMetin;
        };

        // --- ARAYÃœZ FONKSÄ°YONLARI ---
        window.openAuthModal = () => { document.getElementById('authModal').style.display = 'flex'; };
        window.closeAuthModal = () => { document.getElementById('authModal').style.display = 'none'; };
        window.openTopicModal = () => { document.getElementById('topicModal').style.display = 'flex'; };
        window.closeTopicModal = () => { document.getElementById('topicModal').style.display = 'none'; };
        
        window.openReplyModal = (threadId) => { 
            if(!window.isUserLoggedIn) { window.openAuthModal(); return; }
            document.getElementById('replyThreadId').value = threadId;
            document.getElementById('replyModal').style.display = 'flex'; 
        };
        window.closeReplyModal = () => { document.getElementById('replyModal').style.display = 'none'; };

        window.loginWithGoogle = () => {
            signInWithPopup(auth, provider).then(() => { window.closeAuthModal(); })
            .catch((error) => { alert("Hata: " + error.message); });
        };

        window.logoutFirebase = () => {
            signOut(auth).then(() => { window.goToGames(); });
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                window.isUserLoggedIn = true;
                window.currentUsername = user.displayName;
                window.currentUserPhoto = user.photoURL;
                document.getElementById('usernameDisplay').innerText = user.displayName;
                document.getElementById('userPhoto').src = user.photoURL; 
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('userProfile').style.display = 'flex';
            } else {
                window.isUserLoggedIn = false;
                document.getElementById('loginBtn').style.display = 'block';
                document.getElementById('userProfile').style.display = 'none';
            }
        });

        window.goToForum = () => {
            if(window.isUserLoggedIn) {
                document.getElementById('showcaseSection').style.display = 'none';
                document.getElementById('forumSection').style.display = 'block';
                window.scrollTo({top: 0, behavior: 'smooth'}); 
            } else { window.openAuthModal(); }
        };

        window.goToGames = () => {
            document.getElementById('forumSection').style.display = 'none';
            document.getElementById('showcaseSection').style.display = 'block';
            window.scrollTo({top: 0, behavior: 'smooth'}); 
        };

        // --- KONU AÃ‡MA MOTORU ---
        window.submitTopicToDatabase = async () => {
            if(!window.isUserLoggedIn) return;
            let title = document.getElementById('topicTitle').value;
            let body = document.getElementById('topicBody').value;
            let cat = document.getElementById('topicCat').value;
            if(title.trim() === "") { alert("LÃ¼tfen bir baÅŸlÄ±k girin!"); return; }

            // KÃ¼fÃ¼r filtresini Ã§alÄ±ÅŸtÄ±r!
            title = window.sansurle(title);
            body = window.sansurle(body);

            try {
                await addDoc(collection(db, "forum_mesajlari"), {
                    baslik: title,
                    icerik: body,
                    kategori: cat,
                    yazar: window.currentUsername,
                    fotograf: window.currentUserPhoto,
                    tarih: serverTimestamp(),
                    cevaplar: [], // YENÄ°: CevaplarÄ±n dolacaÄŸÄ± depo
                    cevapSayisi: 0
                });
                document.getElementById('topicTitle').value = "";
                document.getElementById('topicBody').value = "";
                window.closeTopicModal();
            } catch (error) { alert("Hata oluÅŸtu!"); }
        };

        // --- CEVAP GÃ–NDERME MOTORU ---
        window.submitReply = async () => {
            let threadId = document.getElementById('replyThreadId').value;
            let replyText = document.getElementById('replyBody').value;
            if(replyText.trim() === "") return;

            // Yorumu da kÃ¼fÃ¼r filtresinden geÃ§ir!
            replyText = window.sansurle(replyText);

            try {
                const threadRef = doc(db, "forum_mesajlari", threadId);
                // Konunun "cevaplar" listesine yeni yorumu ekle
                await updateDoc(threadRef, {
                    cevaplar: arrayUnion({
                        yazar: window.currentUsername,
                        fotograf: window.currentUserPhoto,
                        metin: replyText
                    }),
                    cevapSayisi: Math.floor(Math.random() * 10) + 1 // Sadece sayÄ± gÃ¶rÃ¼nsÃ¼n diye basit artÄ±ÅŸ
                });
                
                document.getElementById('replyBody').value = "";
                window.closeReplyModal();
            } catch (error) { console.error(error); alert("YanÄ±t gÃ¶nderilemedi!"); }
        };

        // --- CANLI EKRAN MOTORU (Konular ve Cevaplar) ---
        const q = query(collection(db, "forum_mesajlari"), orderBy("tarih", "desc"));
        onSnapshot(q, (snapshot) => {
            let container = document.getElementById('threadContainer');
            
            let sabitKonu = `
            <div class="thread-card pinned">
                <div class="thread-main">
                    <div class="thread-avatar" style="border-color: #F1C40F; background: transparent; color: #F1C40F; font-size: 20px;">ğŸ‘‘</div>
                    <div class="thread-content">
                        <h3 class="thread-title"><span style="background: #F1C40F; color: #000;">SABÄ°T</span> ğŸ“Œ HoÅŸ Geldiniz! Forum KurallarÄ± ve KullanÄ±m Rehberi</h3>
                        <div class="thread-body">Yeni Ã¼yelerimiz, lÃ¼tfen konu aÃ§madan Ã¶nce oyun kategorilerine dikkat edelim. KÃ¼fÃ¼r ve argo kullanÄ±mÄ± yasaktÄ±r. Ä°yi oyunlar!</div>
                        <div class="thread-meta">
                            <span class="thread-author">Admin_Mustafa</span> â€¢ ğŸ“… Kurucu â€¢ ğŸ“ Kategori: Genel TartÄ±ÅŸma
                        </div>
                    </div>
                </div>
            </div>`;
            container.innerHTML = sabitKonu;

            snapshot.forEach((docSnap) => {
                let data = docSnap.data();
                let threadId = docSnap.id; // YENÄ°: MesajÄ±n Google'daki kimlik numarasÄ±
                
                let saatStr = "Az Ã–nce";
                if(data.tarih) {
                    let d = data.tarih.toDate();
                    saatStr = d.getHours() + ":" + String(d.getMinutes()).padStart(2, '0');
                }

                // EÄER KONUNUN ALTINDA CEVAPLAR VARSA ONLARI DA Ã‡Ä°Z
                let cevaplarHTML = "";
                if(data.cevaplar && data.cevaplar.length > 0) {
                    cevaplarHTML += `<div class="replies-container">`;
                    data.cevaplar.forEach(cevap => {
                        cevaplarHTML += `
                        <div class="reply-item">
                            <div class="reply-avatar"><img src="${cevap.fotograf}" alt="Profil"></div>
                            <div class="reply-content">
                                <span class="reply-author">${cevap.yazar}</span>
                                ${cevap.metin}
                            </div>
                        </div>`;
                    });
                    cevaplarHTML += `</div>`;
                }

                let html = `
                <div class="thread-card" style="border-color: #1ABC9C; animation: fadeIn 0.5s;">
                    <div class="thread-main">
                        <div class="thread-avatar">
                            <img src="${data.fotograf || 'https://via.placeholder.com/50'}" alt="Profil">
                        </div>
                        <div class="thread-content">
                            <h3 class="thread-title">${data.baslik}</h3>
                            ${data.icerik ? `<div class="thread-body">${data.icerik}</div>` : ''}
                            
                            <div class="thread-meta">
                                <span class="thread-author">${data.yazar}</span> â€¢ ğŸ“… ${saatStr} â€¢ ğŸ“ Kategori: ${data.kategori}
                            </div>
                            
                            <div class="thread-actions">
                                <button class="reply-btn" onclick="openReplyModal('${threadId}')">ğŸ’¬ Cevap Yaz</button>
                            </div>
                        </div>
                    </div>
                    ${cevaplarHTML}
                </div>`;
                
                container.insertAdjacentHTML('beforeend', html);
            });
        });
    </script>
</body>
</html>